$(function(){function e(){if(0==window.orientation||180==window.orientation){$("body").attr("class","portrait"),orientation="portrait";var e=$(window).height(),t=$(window).width();$(".container").width(t),$(".slideBox").css("max-height","190px");var i=$(".slideBox").height(),s=$(".top").height();return $(".stem").height(e-s-i-32),$("iframe").height(e-s-i+100),$(".modal-content").width(t),$(".modal-content").css("left",(t-$(".modal-content").width())/2+"px"),n.isLast=!1,n.touchSlide(n.index),n.changeOrient(),$(".check_btn").css("width","20%"),$(".radio_btn").css("width","20%"),$(".btn-submit,#allExercise").width(t),!1}if(90==window.orientation||window.orientation==-90){$("body").attr("class","landscape"),orientation="landscape";var e=$(window).height(),t=$(window).width(),i=$(".slideBox").height(),s=$(".top").height();return $(".slideBox").css("max-height","120px"),$(".stem").height(e-s-i+35),$("iframe").height(e-s-i+100),$(".container").width(.66*t),$(".btn-submit,#allExercise").width(.66*t),$(".modal-content").width(.66*t),$(".modal-content").css("left",(t-$(".modal-content").width())/2+"px"),$("modal-body").css("height","90px"),n.isLast=!1,n.touchSlide(n.index),n.changeOrient(),$(".check_btn").css("width","20%"),!1}}function t(){0==o?($(".guide2modal").find(".modal-head").css("display","none"),$(".guide2modal").find(".modal-body").css("display","block"),o=1):(modal_hide("guide2modal"),o=0)}var i={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",10:"K",11:"L",12:"M",13:"N",14:"O",15:"P",16:"Q",17:"R",18:"S",19:"T",20:"U",21:"V",22:"W",23:"X",24:"Y",25:"Z"},s=(API.localStorage("exercise"),API.localStorage("exerciseScore"));if(API.localStorage("exercise",""),s.length>0)return API.localStorage("exerciseScore",""),void window.history.go(-1);var a=function(){var e=this;e.init(),e.index=0,e.selectClass="select",e.params={paperID:API.getQueryString("paperID"),phaseID:API.getQueryString("phaseID"),subjectID:API.getQueryString("subjectID"),paperResource:API.getQueryString("paperResource"),qidResource:API.getQueryString("qidResource"),questionStartTime:""},e.getData()};a.prototype={init:function(){var e=this;e.jdom={topTotal:$("#topTotal"),lookAll:$("#lookAll"),questionDiv:$("#questionDiv"),questionImg:$("#questionDiv img"),questionTypeName:$("#questionTypeName"),answerArea:$(".slideBox .bd ul"),allExercise:$("#allExercise"),allExerciseModal:$(".allExercise-modal")},e.bindUI()},bindUI:function(){var e=this;e.jdom.lookAll.click(function(){e.jdom.allExercise.fadeIn(300),e.setAllHeight()}),$(".slideBox").on("click",".bd ul .questionSelect",function(){var t=$(this),i=t.closest("li"),s=i.attr("mcsn"),a=e.questions[s];t.hasClass(e.selectClass)?t.removeClass(e.selectClass):(t.addClass(e.selectClass),2==a.dataType&&(t.parent().siblings().find(".questionSelect").removeClass(e.selectClass),a.index<e.data.count-1?e._touchSlide.next():(e.jdom.allExercise.fadeIn(300),e.setAllHeight()))),i.find(".questionSelect."+e.selectClass).length>0?e.jdom.allExercise.find(".main label:eq("+a.index+")").find("em").addClass("btn_selected"):e.jdom.allExercise.find(".main label:eq("+a.index+")").find("em").removeClass("btn_selected")}),e.jdom.allExercise.click(function(t){e.jdom.allExercise.fadeOut(300),API.stopPropagation(t)}),e.jdom.allExercise.on("click",".main label em",function(){e._touchSlide.setIndex(parseInt($(this).html())-1),e.jdom.allExercise.fadeOut(300)}),e.jdom.allExerciseModal.click(function(e){"EM"!=e.target.tagName&&API.stopDefaultAndPropagation(e)}),$(".btn-submit").click(function(t){e.getAllAnswer(),API.stopDefaultAndPropagation(t)}),$(".btn-return").click(function(){e.jdom.allExercise.fadeOut(300)}),e.jdom.questionDiv.click(function(){var t=new Image,i=$(".divImg .bigimg "),s=e.jdom.questionImg.attr("src");t.src=s;var a=t.height,n=(window.innerHeight-a)/2,o=window.innerHeight-80,l="40px";n<0&&(n=20),a<o&&(o=a+10,l=n),i.attr("src",s),$(".divImg").css({width:window.innerWidth,height:o}).css("margin-top",l),$(".modalImg").show(),$(".divImg").scrollLeft(0).scrollTop(0)}),$(".modalImg").click(function(){$(this).hide()})},setAllHeight:function(){var e=this;e.jdom.allExerciseModal.css("height","auto"),e.jdom.allExercise.find("div.main").css("height","auto");var t=e.jdom.allExerciseModal.height();e.jdom.allExerciseModal.css("height",t),e.jdom.allExercise.find("div.main").css("height",t-103)},changeOrient:function(){var e=this;if("none"!=e.jdom.allExercise.css("display")&&e.setAllHeight(),"none"!=$(".modalImg").css("display")){var t=new Image,i=$(".divImg .bigimg "),s=i.attr("src");t.src=s;var a=t.height,n=(window.innerHeight-a)/2,o=window.innerHeight-80,l="40px";n<0&&(n=20),a<o&&(o=a+10,l=n),$(".divImg").css({width:window.innerWidth,height:o}).css("margin-top",l)}},getData:function(){var e=this;layer.open({type:2,content:"加载数据中....",shadeClose:!1}),API.ajax("getExericse",{paperID:e.params.paperID,phaseID:e.params.phaseID,subjectID:e.params.subjectID,paperResource:e.params.paperResource,qidResource:e.params.qidResource,questionStartTime:e.params.questionStartTime},function(t){layer.closeAll(),t&&0==t.status&&t.paperID?0==t.isPractice?e.render(t):layer.open({content:"您已经做过该练习，自动跳转至练习成绩页面",skin:"msg",time:2,end:function(){API.localStorage("exercise","1"),window.location.href="ExerciseScore.html?paperID="+e.params.paperID+"&phaseID="+e.params.phaseID+"&subjectID="+e.params.subjectID+"&paperResource="+e.params.paperResource+"&qidResource="+e.params.qidResource}}):layer.open({content:"没有获取到数据",btn:"我知道了"})})},render:function(t){var s=this;if(s.data=t,s.questions={},t&&t.paperID)if(s.jdom.topTotal.html(t.paperName),s.params.questionStartTime=t.questionStartTime,0==t.guidePage&&$(".guidInfo").addClass("guide2modal"),t.questions.length>0){var a="",n="";for(var o in t.questions){var l=0,r="请作答<i>",c=t.questions[o],d=c.mcsn,u="";if(c.isSub>1&&(u="【"+c.subQuestionID+"】"),0==c.type?0==c.oneSelect?(l=3,r+="（多选题）"):(l=2,r+="（单选题）"):1==c.type&&(l=1),r+=u+"</i>",c.dataType=l,c.index=parseInt(o),a+='<li class="'+(3==l?"check":"")+'"  mcsn="'+c.mcsn+'" ><div class="table-top cf"><span>'+r+"</span><span><em>"+d+"</em>/"+t.count+"</span></div>",1==c.type)a+='<div class="table-tip cf">该题不支持在线作答，可在提交后查看答案和解析</div>';else{a+='<div class="table-tip cf">';for(var m=0;m<c.selects;m++)a+='<div class="questionSelect_div cf"><span index="'+m+'" class="questionSelect">'+i[m]+"</span></div>";a+="</div>"}a+="</li>",n+='<label class="radio_btn"> <input type="radio"><em>'+d+"</em> </label>",s.questions[c.mcsn]=c}s.jdom.answerArea.html(a),s.touchSlide(),s.jdom.allExercise.find("div.main").append(n),e()}else layer.open({content:"该练习还没有分配题目，请联系管理员",btn:"我知道了"})},touchSlide:function(e){var t=this;e=e||0,t.jdom.questionImg.attr("src",t.data.questions[e].url),t._touchSlide=new TouchSlide({slideCell:"#slideBox",titCell:".hd ul",mainCell:".bd ul",effect:"left",delayTime:600,autoPage:!0,defaultIndex:e,startFun:function(e,i){if(t.index=e,t.isLast&&e+1==i)t.jdom.allExercise.fadeIn(300),t.setAllHeight();else{e+1==i?t.isLast=!0:t.isLast=!1;var s=$("#questionIframe");s.attr("src")!=t.data.questions[e].url&&t.jdom.questionImg.attr("src",t.data.questions[e].url)}}})},next:function(e){},getAllAnswer:function(e){e=e||1;var t=this,s=[];$(".slideBox .bd ul").find("li").each(function(a,n){var o=$(this),l=o.attr("mcsn"),r=t.questions[l],c=[];return o.find(".questionSelect."+t.selectClass).each(function(){c.push(i[$(this).attr("index")])}),3!=e&&0==c.length&&1!=r.dataType?(e=2,layer.open({content:"您尚有未作答试题，提交后不可修改，确定提交？",btn:["继续提交","返回"],btn2:function(e){layer.close(e)},yes:function(e){layer.close(e),t.getAllAnswer(3)}}),success=!1,!1):void s.push(r.mcsn+"-"+r.qid+"-"+r.subQuestionID+"-"+c.join(""))}),1==e?layer.open({content:"提交后不可修改，确定提交？",btn:["继续提交","返回"],btn2:function(e){layer.close(e)},yes:function(e){layer.close(e),t.getAllAnswer(3)}}):3==e&&t.submitAnswer(s.join(","))},submitAnswer:function(e){var t=this;e&&e.length>0&&(layer.open({type:2,content:"提交答案中",shadeClose:!1}),setTimeout(function(){API.ajax("submitAnswer",{paperID:t.params.paperID,phaseID:t.params.phaseID,subjectID:t.params.subjectID,questionStartTime:t.params.questionStartTime,paperResource:t.params.paperResource,qidResource:t.params.qidResource,answers:e},function(e){layer.closeAll(),e&&0==e.status?(API.localStorage("exercise","1"),API.localStorage("defaultTree",""),window.location.href="ExerciseScore.html?paperID="+t.params.paperID+"&phaseID="+t.params.phaseID+"&subjectID="+t.params.subjectID+"&paperResource="+t.params.paperResource+"&qidResource="+t.params.qidResource):layer.open({content:e.msg,btn:"我知道了"})})},200))}};var n=new a;$(window).bind("orientationchange",function(t){e()});var o=0;$(".guidInfo").children(".modal-content").click(function(){t()}),$(".guidInfo").children(".modal-mask").click(function(){t()})});