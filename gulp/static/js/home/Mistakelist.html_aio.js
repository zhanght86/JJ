$(function(){function e(){if(0==window.orientation||180==window.orientation){$("body").attr("class","portrait"),orientation="portrait",$(".supernat").css("height","211px");var e=$(window).width(),t=$(window).height(),i=$(".palette0").height(),n=$(".top").height(),o=($(".comprehension").height(),$(".topic-analysis").height()),a=$(".supernat").height(),s=t-n-a-20-i,r=$(".top").height(),d=t-o;return $(".container").width(e),$(".content1").height(d),$(".stem1").height(s),$(".content_s").height(t-i),$(".content").height(t-i),$(".reading_body").find(".stem").height(t-a-i-r-30),$(".stem1 iframe").height(t-r-i+50),!1}if(90==window.orientation||window.orientation==-90){$("body").attr("class","landscape"),orientation="landscape";var e=$(window).width(),t=$(window).height(),i=$(".palette0").height(),n=$(".top").height(),o=($(".comprehension").height(),$(".topic-analysis").height());$(".supernat").css("height","100px");var a=$(".supernat").height(),s=t-n-a-20-i,r=$(".top").height(),d=t-o;return $(".container").width(.66*e),$(".content1").height(d),$(".stem1").height(s),$(".content_s").height(t-i),$(".content").height(t-i),$(".reading_body").find(".stem").height(t-a-i-r-30),$(".stem1 iframe").height(t-r-i+100),!1}}var t=function(){var e=this;e.init(),e.params={kid:API.getQueryString("kid"),phaseID:API.getQueryString("phaseID"),subjectID:API.getQueryString("subjectID"),timeID:API.getQueryString("timeID")},e.paperResource="02",e.qidResource="05",e.pageCount=10,e.pageIndex=0,e.totalIndex=1,e.getData()};t.prototype={init:function(){var e=this;e.jdom={span_name:$("#span_name"),deleteAll:$("#deleteAll"),content_list:$("#content_list"),createPaper:$("#createPaper"),loading:$(".loading-tip")},e.bindUI()},bindUI:function(){var e=this;e.jdom.deleteAll.click(function(){layer.open({content:"确定要删除全部错题？",btn:["确定","取消"],btn2:function(e){layer.close(e)},yes:function(t){layer.close(t),e.deleteErrorquestions()}})}),e.jdom.createPaper.click(function(){layer.open({type:2,content:"正在生成试卷...",shadeClose:!1}),API.ajax("createPaper",{phaseID:e.params.phaseID,subjectID:e.params.subjectID,knowledgeID:e.params.kid},function(t){layer.closeAll(),t&&0==t.status?window.open("Exercise.html?paperID="+t.paperID+"&phaseID="+e.params.phaseID+"&subjectID="+e.params.subjectID+"&paperResource="+e.paperResource+"&qidResource="+e.qidResource,"Exercise"):layer.open({content:t.msg,btn:"我知道了"})})}),e.jdom.content_list.on("click",".tiganImg",function(){window.open("MistakeDetail.html?phaseID="+e.params.phaseID+"&subjectID="+e.params.subjectID+"&kid="+e.params.kid+"&qid="+$(this).parent("div.stemDiv").attr("qid"),"errorDetail")}),e.jdom.content_list.on("click",".deleteicon",function(){e.deleteErrorquestions($(this).closest("div.stemDiv").attr("qid"))}),$(window).scroll(function(){var t=$(window).scrollTop()>=$(document).height()-$(window).height()-50;t&&e.getData()})},getData:function(){var e=this;return e.pageIndex>=e.totalIndex?($("#loadover").text("没有更多").css("visibility","visible"),void setTimeout(function(){$("#loadover").css("visibility","hidden")},1400)):($("#loadover").text("正在加载").css("visibility","visible"),e.pageIndex++,void API.ajax("getErrorquestions",{subjectID:e.params.subjectID,phaseID:e.params.phaseID,timeID:e.params.timeID,knowledgeID:e.params.kid,pageIndex:e.pageIndex,pageCount:e.pageCount},function(t){$("#loadover").css("visibility","hidden"),t&&0==t.status?(e.jdom.span_name.html(t.name+"("+t.count+"题)"),e.render(t.data),e.totalIndex=t.totalIndex||1):e.totalIndex=1}))},deleteErrorquestions:function(e){var t=this;e=e||0,API.ajax("deleteErrorquestions",{knowledgeID:t.params.kid,questionID:e},function(i){i&&(0==i.status?(API.localStorage("defaultTree",""),0==e?(t.totalIndex=1,t.pageIndex=0,t.jdom.content_list.find("div.stemDiv").remove(),window.history.go(-1)):(t.jdom.content_list.find("div[qid="+e+"].stemDiv").remove(),0==t.jdom.content_list.find("div.stemDiv").length&&window.history.go(-1))):layer.open({content:i.msg,btn:"我知道了"}))})},render:function(t){console.log(t);for(var i=this,n="",o=0,a=t.length;o<a;o++)n+='<div qid="'+t[o].questionID+'" class="stem cf stemDiv"><img class="tiganImg" src="'+t[o].questionTextHTML+'"><div class="handle cf"> <div class="sourse-left cf"> <span>来源：</span> <span class="redundant cf">'+t[o].sourceName+'</span> </div> <a class="deleteicon" href="javascript:;"> </a> </div></div>';0==n.length&&(n='<div class="mCourseNone cf" style="display: block;"> <span> <img src="http://xuexin-file.oss-cn-hangzhou.aliyuncs.com/xxkt/mCourseNone.png"> </span> <p>暂无错题</p> </div>'),i.jdom.loading.before(n),1==i.pageIndex&&e()}};new t;$(window).bind("orientationchange",function(t){e()})});