var mistakeobj;$(function(){function e(){if(0==window.orientation||180==window.orientation){$("body").attr("class","portrait"),orientation="portrait";var e=$(window).width(),t=$(window).height(),a=$(".fix-tab").height();return $(".mainbody").height(t-a),$(".container").width(e),!1}if(90==window.orientation||window.orientation==-90){$("body").attr("class","landscape"),orientation="landscape";var e=$(window).width(),t=$(window).height(),a=$(".fix-tab").height();return $(".mainbody").height(t-a),$(".container").width(.66*e),!1}}var t=function(){var e=this;e.subject={phaseID:API.getQueryString("phaseID"),subjectID:API.getQueryString("subjectID"),subjectName:API.getQueryString("subjectName")},e.time={timeID:API.getQueryString("timeID"),name:API.getQueryString("timeName")},e.params={multiChild:API.getQueryString("multiChild"),role:API.getQueryString("role"),name:API.getQueryString("name")},e.paperResource="02",e.qidResource="05",e.init(),e.getData()};t.prototype={init:function(){var e=this;e.jdom={subject:$("#jsubject"),time:$("#jtime"),tree_div:$("#treedemo"),statisticsError:$("span.statisticsError"),todayError:$("span.todayError")},e.bindUI()},bindUI:function(){var e=this;e.jdom.subject.click(function(){var t="?phaseID={phaseID}&subjectID={subjectID}&subjectName={subjectName}&timeID="+e.time.timeID+"&timeName="+e.time.name+API.format("&multiChild={multiChild}&role={role}&name={name}",e.params);e.hasData?API.localStorage("defaultTree","-"+e.subject.subjectID+"-"+e.time.timeID+"-"+e.jdom.tree_div.html()):API.localStorage("defaultTree",""),window.location.href="choosesubject.html?phaseID="+e.subject.phaseID+"&subjectID="+e.subject.subjectID+"&url="+encodeURIComponent(window.location.href.split("?")[0]+t)}),e.jdom.time.click(function(){var t=API.format("?phaseID={phaseID}&subjectID={subjectID}&subjectName={subjectName}&",e.subject)+"timeID={timeID}&timeName={timeName}"+API.format("&multiChild={multiChild}&role={role}&name={name}",e.params);e.hasData?API.localStorage("defaultTree","-"+e.subject.subjectID+"-"+e.time.timeID+"-"+e.jdom.tree_div.html()):API.localStorage("defaultTree",""),window.location.href="SelectTime.html?url="+encodeURIComponent(window.location.href.split("?")[0]+t)}),e.jdom.tree_div.on("click","div.tree_item.tree_has",function(e){e.preventDefault();var t=$(this),a=t.attr("haveclick");"no"==a?(t.attr("haveclick","yes"),t.parent().children(".wtree").slideDown("slow"),t.children(".item-left").css({borderBottom:"solid 1px #eee"}),t.siblings(".wtree:not(:last-child)").find(".item-left").css({borderBottom:"solid 1px #eee"}),t.parent("li").children(".wtree:last-child").children("li").children(".tree_item").children(".item-left").css({borderBottom:"solid 1px #eee"}),t.parents("li").css({borderBottom:"0"})):(t.attr("haveclick","no"),t.parent().children(".wtree").slideUp("slow",function(){t.parent("li").children(".wtree:last-child").children("li").children(".tree_item").children(".item-left").css({borderBottom:"0"})})),$(".level4").find(".item-left").css({borderBottom:"0"})}),e.jdom.tree_div.on("click","div.scanError ",function(t){t.preventDefault(),e.hasData?API.localStorage("defaultTree","-"+e.subject.subjectID+"-"+e.time.timeID+"-"+e.jdom.tree_div.html()):API.localStorage("defaultTree",""),window.open("Mistakelist.html?phaseID="+e.subject.phaseID+"&subjectID="+e.subject.subjectID+"&timeID="+e.time.timeID+"&kid="+$(this).closest("div.tree_item").attr("kid"),"scanError")}),e.jdom.tree_div.on("click","a.btn-practice",function(t){t.preventDefault(),layer.open({type:2,content:"正在生成试卷...",shadeClose:!1}),API.ajax("createPaper",{phaseID:e.subject.phaseID,subjectID:e.subject.subjectID,knowledgeID:$(this).closest("div.tree_item").attr("kid")},function(t){layer.closeAll(),t&&0==t.status?(e.hasData?API.localStorage("defaultTree","-"+e.subject.subjectID+"-"+e.time.timeID+"-"+e.jdom.tree_div.html()):API.localStorage("defaultTree",""),window.open("Exercise.html?paperID="+t.paperID+"&phaseID="+e.subject.phaseID+"&subjectID="+e.subject.subjectID+"&paperResource="+e.paperResource+"&qidResource="+e.qidResource,"Exercise")):layer.open({content:t.msg,btn:"我知道了"})})}),$(".btnChild").click(function(){var t="?phaseID={phaseID}&subjectID={subjectID}&subjectName={subjectName}&timeID={timeID}&timeName={timeName}&multiChild={multiChild}&role={role}&name={name}";e.hasData?API.localStorage("defaultTree","-"+e.subject.subjectID+"-"+e.time.timeID+"-"+e.jdom.tree_div.html()):API.localStorage("defaultTree",""),window.location.href="tabchild.html?type=2&url="+encodeURIComponent(window.location.href.split("?")[0]+t)}),$(".mainbody").on("click",".btn-practice button",function(){window.location.href="consolidateexer.html?"+window.location.href.split("?")[1]})},getData:function(){var e=this,t="-"+e.subject.subjectID+"-"+e.time.timeID+"-",a=API.localStorage("defaultTree");window.history.length>1&&0==a.indexOf(t)?(e.getStatistics(),$(".hasdata").show(),e.jdom.tree_div.html(a.replace(t,"")),e.hasData=!0):(layer.open({type:2,content:"",shadeClose:!1}),e.getStatistics(),API.localStorage("defaultTree",""),API.ajax("getErrorKnowlegeTree",{phaseID:e.subject.phaseID,subjectID:e.subject.subjectID,timeID:e.time.timeID},function(t){layer.closeAll(),t&&0==t.status&&t.data.length>0?($(".hasdata").show(),e.jdom.tree_div.html(e.getTreeHtml(t.data)),e.hasData=!0,$(".level1").children("li").children(".level4:last-child").find(".last-gh").css({borderBottom:"0"})):($(".mainbody").append('<div class="no-recommend"><p class="no-recommend-tit">当前条件下暂无错题，去练习一下吧~</p></div><div class="btn-practice"><button>去练习</button></div>'),e.hasData=!1)})),e.jdom.subject.find(".jvalue").html(e.subject.subjectName),e.jdom.time.find(".jvalue").html(e.time.name),"0"==e.params.role?($(".textChild").html(e.params.name),"1"==e.params.multiChild?$(".btnChild").show():$(".btnChild").hide(),$(".changeChild").show()):$(".changeChild").height(0)},getStatistics:function(){var e=this;API.ajax("getStatistics",{phaseID:e.subject.phaseID,subjectID:e.subject.subjectID,timeID:e.time.timeID},function(t){t&&0==t.status&&(e.jdom.statisticsError.html(t.statisticsError),e.jdom.todayError.html(t.todayError))})},createPaper:function(e){var t=this;API.ajax("createPaper",{knowledgeID:e,paperSource:t.paperSource,qidSource:t.qidSource},function(e){console.log(e)})},getTreeHtml:function(e,t){var a=this;t=t||1;var i="",s=[];for(var r in e){var l="<li>";0==e[r].isLeaf?(l+=3==t?'<div class="tree_item tree_has" level="'+t+'" haveclick="no"><span class="clickicon"></span><div class="cf item-left"><span class="item-tit ellips">'+e[r].knowledgeName+'</span><a class="state-s state-'+(0==e[r].isPass?"p":"e")+' " href="javascript:;"></a></div></div>':'<div class="tree_item tree_has" level="'+t+'" haveclick="no"><div class="cf item-left"><span class="clickicon"></span><span class="item-tit ellips">'+e[r].knowledgeName+'</span><a class="state-s state-'+(0==e[r].isPass?"p":"e")+' " href="javascript:;"></a></div></div>',l+=a.getTreeHtml(e[r].leafKnowledges,t+1)):l+='<ul class="level4"><li><div kid="'+e[r].knowledgeID+'" class="tree_item" level="4" haveclick="yes"><span class="clickicon isleaf"></span><div class="cf item-left"><div class="item-last cf scanError"><span class="item-tit ellips">'+e[r].knowledgeName+'</span><span class="choose-icon"></span></div></div><div class="last-gh cf">'+(0==e[r].isPass?'<p class="thoh-c"><a href="javascript:;" class="go-p"></a>已通过</p>':'<p class="gon-c"><a href="javascript:;" class="state-e"></a>需巩固</p>')+'<a href="javascript:;" class="btn-practice">巩固练习</a></div></div></li></ul>',l+="</li>",s.push(l)}return i='<ul class="wtree level'+t+'">'+s.join(""),i+="</ul>"}},mistakeobj=new t,$(window).bind("orientationchange",function(t){e()}),$("body").css("background-color","#f8f8f8"),e()});